---
- hosts: all
  gather_facts: no

  vars: 
    packages:
      - gcc
      - debconf-utils
      - git
      - nodejs
      - maven
      - wget
      - mysql-server
      - mysql-client
      - python3-pymysql
  
  tags: itrust
  tasks: 
    - name: Install required packages for iTrust
      apt: pkg={{item}} state=present update_cache=yes
      become: yes
      with_items: "{{packages}}"

    - name: Clone itrust
      tags: itrust
      become: yes
      git:
        repo: https://{{ git_user|urlencode() }}:{{ git_token|urlencode() }}@github.ncsu.edu/engr-csc326-staff/iTrust2-v10
        clone: yes
        update: yes
        dest: "/home/ubuntu/iTrust"

    - name: Make sure mysql is running
      service:
        name: mysql
        state: started
        enabled: True